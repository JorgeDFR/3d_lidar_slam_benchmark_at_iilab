# Docker Environment

This page provides information about the Docker environment used for benchmarking the 3D LiDAR-based SLAM algorithms in the IILABS 3D dataset.

## Overview

To ensure reproducibility and consistency in the benchmarking process, we provide a Docker environment that contains all the necessary dependencies and configurations for running the SLAM algorithms. This Docker environment allows researchers to easily replicate our benchmarking results and test their own algorithms under the same conditions.

## Docker Images

The benchmark uses two Docker images:

=== "ROS 1 Image"
    Contains the following SLAM algorithms:
    
    - :octicons-check-circle-fill-24:{ .success } A-LOAM
    - :octicons-check-circle-fill-24:{ .success } LeGO-LOAM-BOR
    - :octicons-check-circle-fill-24:{ .success } LIORF
    - :octicons-check-circle-fill-24:{ .success } DLIO

=== "ROS 2 Image"
    Contains the following SLAM algorithms:
    
    - :octicons-check-circle-fill-24:{ .success } VineSLAM
    - :octicons-check-circle-fill-24:{ .success } KISS-ICP
    - :octicons-check-circle-fill-24:{ .success } GLIM
    - :octicons-check-circle-fill-24:{ .success } Kinematic-ICP
    - :octicons-check-circle-fill-24:{ .success } MOLA-LO

Both images include:

- :material-eye: Visualization tools including RViz
- :material-file-document: All necessary dependencies and configurations

## Installation

### Prerequisites

- :material-docker: [Docker](https://docs.docker.com/get-docker/) installed on your system
- :material-harddisk: At least 10GB of free disk space
- :material-memory: 16GB RAM recommended for optimal performance

!!! info "Guide for installing Docker and other tools in Ubuntu 20.04"
    For more detailed information about the Docker installation and additional setups, please refer to the [Install Docker](install_docker.md) section.

### Setup Instructions

1. Clone the repository:

    ```bash
    git clone https://github.com/JorgeDFR/3d_lidar_slam_benchmark_at_iilab.git
    cd 3d_lidar_slam_benchmark_at_iilab/docker
    ```

2. Build the Docker images:

    ```bash
    # Build the image for ROS 1 (for A-LOAM, LeGO-LOAM-BOR, LIORF, DLIO)
    docker compose build ros1_noetic

    # Build the image for ROS 2 (for KISS-ICP, Kinematic-ICP, GLIM, VineSLAM, MOLA-LO)
    docker compose build ros2_humble
    ```

3. Start the Docker containers:

    ```bash
    # Start ROS 1 container
    docker compose up ros1_noetic -d

    # Start ROS 2 container
    docker compose up ros2_humble -d

    # Or start both containers
    docker compose up -d
    ```

4. Access the Docker containers:

    ```bash
    # Access ROS 1 container
    docker exec -it 3d_slam_ros1 bash

    # Access ROS 2 container
    docker exec -it 3d_slam_ros2 bash
    ```

!!! warning "GUI Applications"
    Before running RViz inside the Docker container, you need to set up `xhost`:
    ```bash
    ./docker/setup_xhost.sh
    ```

## Running SLAM Algorithms

### ROS 1 Algorithms

Inside the ROS 1 container:

```bash
# Set environment variables
export SLAM_CONF=aloam  # Options: aloam, lego_loam_bor, liorf, dlio
export SLAM_SENSOR=velodyne_vlp_16  # Options: velodyne_vlp_16, ouster_os1_64, robosense_rs_helios_5515, livox_mid_360

# Start the SLAM algorithm
roslaunch slam_benchmark_ros1_conf slam_benchmark.launch

# In another terminal, play the rosbag
rosbag play <path_to_bagfile>.bag
```

### ROS 2 Algorithms

Inside the ROS 2 container:

```bash
# Set environment variables
export SLAM_CONF=kiss_icp  # Options: kiss_icp, kinematic_icp, glim, vineslam, mola_lo
export SLAM_SENSOR=velodyne_vlp_16  # Options: velodyne_vlp_16, ouster_os1_64, robosense_rs_helios_5515, livox_mid_360

# Start the SLAM algorithm
ros2 launch slam_benchmark_ros2_conf slam_benchmark.launch.xml

# In another terminal, play the rosbag
ros2 bag play <path_to_bagfile>
```

## Advanced Features

### Offline Processing Mode

Several SLAM algorithms support an offline mode that processes rosbag files faster than real-time:

```bash
# ROS 1
roslaunch slam_benchmark_ros1_conf slam_benchmark.launch run_offline:=true rosbag_path:=<rosbag_file_path>

# ROS 2
ros2 launch slam_benchmark_ros2_conf slam_benchmark.launch.xml run_offline:=true rosbag_path:=<rosbag_file_path>
```

!!! note "Supported Algorithms for Offline Mode"
    The following algorithms currently support offline processing:
    
    - LeGO-LOAM-BOR
    - GLIM
    - Kinematic-ICP
    - MOLA-LO

### Recording Odometry Trajectories

To capture the odometry trajectory generated by the SLAM algorithms:

```bash
# ROS 1
rosbag record -O <output_bag_file_name> /slam_odom

# ROS 2
ros2 bag record -o <output_bag_file_name> /slam_odom
```

!!! warning "MOLA-LO Special Case"
    For MOLA-LO, use the following command:
    ```bash
    # Set environment variable to use the LiDAR frame instead of base_link
    export MOLA_USE_FIXED_LIDAR_POSE=true
    
    mola-lidar-odometry-cli \
        -c $(ros2 pkg prefix mola_lidar_odometry)/share/mola_lidar_odometry/pipelines/lidar3d-default.yaml \
        --input-rosbag2 <path_to_bag_file> \
        --lidar-sensor-label <lidar_topic> \
        --output-tum-path <output_file_path>
    ```
    
    - `<path_to_bag_file>`: Path to your input rosbag file
    - `<lidar_topic>`: LiDAR sensor topic name (`/eve/ouster/points` for Ouster sequences or `/eve/lidar3d` for other sensors)
    - `<output_file_path>`: Desired path for the TUM-formatted trajectory output