# Indoor Benchmark of 3D LIDAR SLAM in iilab - Industry and Innovation Laboratory

TODO

## SLAM Algorithms

**ROS 1**

- [**A-LOAM**](/docs/install/slam_algorithms/install_aloam.md)
- [**LeGO-LOAM**](/docs/install/slam_algorithms/install_lego_loam_bor.md)
- [**LIORF**](/docs/install/slam_algorithms/install_liorf.md)
- [**DLIO**](todo)

**ROS 2**

- [**VineSLAM**](todo)
- [**KISS-ICP**](/docs/install/slam_algorithms/install_kiss_icp.md)
- [**GLIM**](/docs/install/slam_algorithms/install_glim.md)
- [**Kinematic-ICP**](/docs/install/slam_algorithms/install_kinematic_icp.md)
- [**MOLA-LO**](todo)

## IILABS 3D: iilab Indoor LiDAR-based SLAM Dataset

### 3D LiDAR sensors considered in our Dataset

- [**Livox Mid 360**](todo)
- [**Velodyne VLP-16**](todo)
- [**RoboSense RS-HELIOS-5515**](todo)
- [**Ouster OS1-64 REV-C**](todo)

## Sequences present in the dataset

- **Nav A Diff**
- **Nav A Omni**
- **Loop**
- **Slippage**
- **Ramp**
- **Elevator**

TODO: Show sequence images

## Docker

- [**Docker**](https://www.docker.com): Follow the installation guide [here](/docs/install/docker/install_docker.md)

```sh
# Clone this repository
git clone https://gitlab.inesctec.pt/mrdt/projects/greenauto/benchmark-indoor-3d-localization

# Move to the docker folder
cd benchmark-indoor-3d-localization/docker

# Build the image for the ROS distribution desired
docker compose build ros1_noetic # ROS 1
docker compose build ros2_humble # ROS 2

# Start a docker container for the ROS distribution desired
docker compose up ros1_noetic -d # only ROS 1
docker compose up ros2_humble -d # only ROS 2
docker compose up -d # both ROS 1 and ROS 2

# Execute an interactive terminal in the docker container
docker exec -it 3d_slam_ros1 bash # for ROS 1
docker exec -it 3d_slam_ros2 bash # for ROS 2
```
> **Note**: Before running RViz inside the Docker container, you need to set up `xhost`. You can use the `setup_xhost.sh` script located in the `docker` folder. 

**ROS 1**
```sh
# Setup enviroment variables
export SLAM_CONF=aloam # SLAM algorithm (aloam, lego_loam_bor, liorf, dlio)
export SLAM_SENSOR=velodyne_vlp_16 # SLAM sensor (velodyne_vlp_16, ouster_os1_64, robosense_rs_helios_5515, livox_mid_360)

# Start launch file
roslaunch slam_benchmark_ros1_conf slam_benchmark.launch

# Play rosbag (in another terminal window)
rosbag play <bagfile_name>.bag
```

**ROS 2**
```sh
# Setup enviroment variables
export SLAM_CONF=kiss_icp # SLAM algorithm (kiss_icp, kinematic_icp, glim, vinelsam, mola_lo)
export SLAM_SENSOR=velodyne_vlp_16 # SLAM sensor (velodyne_vlp_16, ouster_os1_64, robosense_rs_helios_5515, livox_mid_360)

# Start launch file
ros2 launch slam_benchmark_ros2_conf slam_benchmark.launch.xml

# Play rosbag (in another terminal window)
ros2 bag play <bagfile_name>
```

## Notes

### Running SLAM Algorithms in Offline Mode

Several SLAM algorithms in this benchmark support an offline mode that allows you to process rosbag files faster than real time without dropping any messages. This mode is especially useful for rapid testing and performance evaluation. The following algorithms currently support offline processing:

- **LeGO-LOAM-BOR**
- **GLIM**
- **Kinematic-ICP**
- **MOLA-LO**

To run a SLAM algorithm in offline mode, set the `run_offline` flag to `true` and specify the path to your rosbag file.

**ROS 1**
```sh
roslaunch slam_benchmark_ros1_conf slam_benchmark.launch run_offline:=true rosbag_path:=<rosbag_file_path>
```
**ROS 2**
```sh
ros2 launch slam_benchmark_ros2_conf slam_benchmark.launch.xml run_offline:=true rosbag_path:=<rosbag_file_path>
```
Replace `<rosbag_file_path>` with the full path to your rosbag file.

### Recording the Odometry Trajectory

To capture the odometry trajectory generated by the SLAM algorithms, record the `/slam_odom` topic. The provided scripts automatically remap all relevant topics to `/slam_odom` for consistent output.

**ROS 1**
```sh
rosbag record -O <output_bag_file_name> /slam_odom
```
**ROS 2**
```sh
ros2 bag record -o <output_bag_file_name> /slam_odom
```
Replace `<output_bag_file_name>` with your desired output bag file name.
> **Note:** The MOLA-LO algorithm requires a custom command to record its odometry trajectory.

**Recording Odometry Trajectory for MOLA-LO**

For MOLA-LO, set an environment variable to use the LiDAR frame instead of the default `base_link` frame. This step is necessary because MOLA-LO expects the robot frame to be `base_link`, while the IILABS 3D dataset uses `eve/base_link`. The use the `mola-lidar-odometry-cli` command. For more informations regarding this tool please refer to the [MOLA](https://docs.mola-slam.org/latest/mola_lo_apps.html) main documentation.

```sh
# Set environment variable to use the LiDAR frame instead of base_link
export MOLA_USE_FIXED_LIDAR_POSE=true

mola-lidar-odometry-cli \
    -c $(ros2 pkg prefix mola_lidar_odometry)/share/mola_lidar_odometry/pipelines/lidar3d-default.yaml \
    --input-rosbag2 <path_to_bag_file> \
    --lidar-sensor-label <lidar_topic> \
    --output-tum-path <output_file_path>
```

Replace the placeholders:
- `<path_to_bag_file>`: The path to your input rosbag file.
- `<lidar_topic>`: The LiDAR sensor topic name (`/eve/ouster/points` for ouster sequences or `/eve/lidar3d` for the remaining sensors)
- `<output_file_path>`: The desired path for the TUM-formatted trajectory output.